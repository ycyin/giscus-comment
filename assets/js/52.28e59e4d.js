(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{615:function(e,t,s){"use strict";s.r(t);var a=s(4),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"修改k8s节点主机名并重新加入集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改k8s节点主机名并重新加入集群"}},[e._v("#")]),e._v(" 修改k8s节点主机名并重新加入集群")]),e._v(" "),s("p",[e._v("k8s版本：v1.20.15")]),e._v(" "),s("p",[e._v("部署方式：二进制")]),e._v(" "),s("p",[e._v("目的：将节点名称为"),s("code",[e._v("k8s-node01")]),e._v("修改为"),s("code",[e._v("k8s-node1")]),e._v("，修改后需要删除节点重新加入k8s集群。")]),e._v(" "),s("h2",{attrs:{id:"删除node01节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除node01节点"}},[e._v("#")]),e._v(" 删除Node01节点")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("kubectl delete node k8s-node01\n")])])]),s("h2",{attrs:{id:"删除批准的kubelet证书申请"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#删除批准的kubelet证书申请"}},[e._v("#")]),e._v(" 删除批准的kubelet证书申请")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("root@k8s-master1 k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# kubectl get csr")]),e._v("\nNAME                                                   AGE   REQUESTOR           CONDITION\nnode-csr-WChHl5n7wueANacEBwkRQ-x28TEGYGBsTnxMRvJrX38   37m   kubelet-bootstrap   Approved,Issued\nnode-csr-X0W6e3GF196u_10PZEuV9qxrQSYgTUIkyKt8rY1hb5Y   13m   kubelet-bootstrap   Approved,Issued\nnode-csr-wIdvz5uElyaKQLxRzcI8f_N4TYQI0ipV2tJjfIdnj0E   26m   kubelet-bootstrap   Approved,Issued\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("root@k8s-master1 k8s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# kubectl delete csr node-csr-WChHl5n7wueANacEBwkRQ-x28TEGYGBsTnxMRvJrX38")]),e._v("\ncertificatesigningrequest.certificates.k8s.io "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"node-csr-WChHl5n7wueANacEBwkRQ-x28TEGYGBsTnxMRvJrX38"')]),e._v(" delete\n")])])]),s("p",[e._v("在node01节点上删除master节点批准其加入集群时，自动颁发的证书：")]),e._v(" "),s("p",[e._v("自动颁发的证书，在Node节点上的目录："),s("code",[e._v("/opt/kubernetes/ssl/")]),e._v("\n删除证书自动颁发的是kubelet的证书，注意查看可能还有其它不能删文件，自行甄别")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("rm")]),e._v(" -f /opt/kubernetes/ssl/kubelet*\n")])])]),s("h2",{attrs:{id:"修改node01主机名配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改node01主机名配置"}},[e._v("#")]),e._v(" 修改Node01主机名配置")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("vi")]),e._v(" /opt/kubernetes/cfg/kubelet.conf\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 修改")]),e._v("\n--hostname-override"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("k8s-node1\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("vi")]),e._v(" /opt/kubernetes/cfg/kube-proxy-config.yml\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 修改")]),e._v("\nhostnameOverride: k8s-node1\n")])])]),s("h2",{attrs:{id:"修改master节点的hosts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改master节点的hosts"}},[e._v("#")]),e._v(" 修改master节点的hosts")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("cat >> /etc/hosts << EOF \n192.168.88.113 k8s-master1 \n192.168.88.123 k8s-node1 # 我们修改的\n192.168.88.124 k8s-node2 \nEOF \n")])])]),s("h2",{attrs:{id:"重启node1的kubelet和kube-proxy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启node1的kubelet和kube-proxy"}},[e._v("#")]),e._v(" 重启Node1的kubelet和kube-proxy")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("systemctl restart kubelet\nsystemctl restart kube-proxy\n")])])]),s("h2",{attrs:{id:"重新批准kubelet证书申请"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重新批准kubelet证书申请"}},[e._v("#")]),e._v(" 重新批准kubelet证书申请")]),e._v(" "),s("p",[e._v("此时在master节点执行：kubectl get csr 可以看到node1节点重新申请加入集群")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("root@k8s-master1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# kubectl get csr")]),e._v("\nNAME                                                   AGE   REQUESTOR           CONDITION\nnode-csr-o-EQcnmUdhShDN1qDpuMEBtcg124OCBeatJezPYnefw   3s    kubelet-bootstrap   Pending\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("root@k8s-master1 ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# kubectl certificate approve node-csr-o-EQcnmUdhShDN1qDpuMEBtcg124OCBeatJezPYnefw")]),e._v("\n")])])]),s("p",[s("em",[e._v("参考：")])]),e._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/a13568hki/article/details/123635793",target:"_blank",rel:"noopener noreferrer"}},[e._v("k8s node节点删除并重新加入_人生匆匆的博客-CSDN博客_k8s 删除node节点,重新加入"),s("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);