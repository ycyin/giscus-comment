(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{486:function(s,a,t){s.exports=t.p+"assets/img/20210111112847.63209237.png"},487:function(s,a,t){s.exports=t.p+"assets/img/20210108100916.6019f1c1.png"},488:function(s,a,t){s.exports=t.p+"assets/img/20210108101321.0fa2eda4.png"},489:function(s,a,t){s.exports=t.p+"assets/img/20210111173002.85a2f1c1.png"},490:function(s,a,t){s.exports=t.p+"assets/img/20210111172623.7d1a91bc.png"},491:function(s,a,t){s.exports=t.p+"assets/img/20210108114254.92b0e0c9.png"},492:function(s,a,t){s.exports=t.p+"assets/img/20210108114105.d914a2dd.png"},493:function(s,a,t){s.exports=t.p+"assets/img/20210108114306.e373cbb6.png"},494:function(s,a,t){s.exports=t.p+"assets/img/20210111175017.cd19b3ea.png"},495:function(s,a,t){s.exports=t.p+"assets/img/20210111175434.35a8dc7f.png"},496:function(s,a,t){s.exports=t.p+"assets/img/20210111175526.9b3d19e1.png"},497:function(s,a,t){s.exports=t.p+"assets/img/20210112111042.9cd99d82.png"},498:function(s,a,t){s.exports=t.p+"assets/img/20210112114114.d37ce4d5.png"},499:function(s,a,t){s.exports=t.p+"assets/img/20210112114154.5e09d081.png"},572:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("p",[s._v("在众多持续集成/持续部署(CI/CD)工具中（如"),e("strong",[s._v("GitLab CI")]),s._v("、"),e("strong",[s._v("Travis CI")]),s._v("、"),e("strong",[s._v("TeamCity")]),s._v("等），有人说"),e("a",{attrs:{href:"https://www.jdon.com/52172",target:"_blank",rel:"noopener noreferrer"}},[s._v("Jenkins已经老了"),e("OutboundLink")],1),s._v("，现在也有很多优秀的"),e("a",{attrs:{href:"http://www.360doc.com/content/20/1111/12/46368139_945280698.shtml",target:"_blank",rel:"noopener noreferrer"}},[s._v("Jenkins替代方案"),e("OutboundLink")],1),s._v("。本文选择"),e("strong",[s._v("Jenkins")]),s._v("仅仅是因为它安装简单、部署简单的项目上手快（有Web界面）。")]),s._v(" "),e("p",[s._v("使用的Jenkins版本："),e("a",{attrs:{href:"https://jenkins.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Jenkins 2.263.1"),e("OutboundLink")],1),s._v("，部署机器：CentOS 7")]),s._v(" "),e("p",[s._v("使用Jenkins+gitlab实现自动部署vue项目基本思路：gitlab每次提交代码使用 GitLab 的 WebHook 来触发 Jenkins 构建，Jenkins执行shell脚本打包Vue项目，然后将打包后的静态文件复制到nginx指定的html目录中。")]),s._v(" "),e("h2",{attrs:{id:"安装环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装环境"}},[s._v("#")]),s._v(" 安装环境")]),s._v(" "),e("h3",{attrs:{id:"安装jdk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装jdk"}},[s._v("#")]),s._v(" 安装JDK")]),s._v(" "),e("blockquote",[e("p",[s._v("Jenkins基于Java开发，所以需要Java运行环境。")])]),s._v(" "),e("p",[e("a",{attrs:{href:"http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),e("OutboundLink")],1),s._v("选择对应JDK版本下载链接：")]),s._v(" "),e("p",[s._v("下载：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://download.oracle.com/otn/java/jdk/8u271-b09/61ae65e088624f5aaa0b1d2d801acb16/jdk-8u271-linux-x64.tar.gz?AuthParam"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("1610086904_2c9dd4492a9232e623d371bcdaaae54f\n")])])]),e("p",[s._v("创建安装目录")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /usr/local/java/\n")])])]),e("p",[s._v("解压至安装目录")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf jdk-8u271-linux-x64.tar.gz -C /usr/local/java/\n")])])]),e("p",[s._v("设置环境变量：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/profile\n")])])]),e("p",[s._v("在末尾添加")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/java/jdk1.8.0_271\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JRE_HOME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/jre\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLASSPATH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/lib:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JRE_HOME}")]),s._v("/lib\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_HOME}")]),s._v("/bin:"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n")])])]),e("p",[s._v("使环境变量生效")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])])]),e("p",[s._v("添加软链接")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/java/jdk1.8.0_271/bin/java /usr/bin/java\n")])])]),e("p",[s._v("检查")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("java -version\n")])])]),e("h3",{attrs:{id:"安装jenkins"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins"}},[s._v("#")]),s._v(" 安装Jenkins")]),s._v(" "),e("blockquote",[e("p",[s._v("通过尝试，使用Jenkins不推荐用Docker方式安装，会因为缺少环境而造成不必要的麻烦。")]),s._v(" "),e("p",[s._v("这里使用下载好的安装包安装，yum方式参见"),e("a",{attrs:{href:"https://jenkins.io/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),e("OutboundLink")],1),s._v("，比较慢\n"),e("strong",[s._v("下载rpm包并安装")])])]),s._v(" "),e("p",[s._v("官方镜像：https://pkg.jenkins.io/")]),s._v(" "),e("p",[s._v("推荐 清华镜像站：https://mirrors.tuna.tsinghua.edu.cn/jenkins/（速度快）")]),s._v(" "),e("p",[s._v("中国科学技术大学镜像站：https://mirrors.ustc.edu.cn/jenkins/")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/jenkins-2.263.1-1.1.noarch.rpm\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh jenkins-2.263.1-1.1.noarch.rpm\n")])])]),e("p",[e("strong",[s._v("网络联通配置")])]),s._v(" "),e("p",[s._v("1.如果安装Jenkins的机器启动了安全组策略，需要开放修改后的端口，如下：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp --permanent "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加TCP端口")]),s._v("\nfirewall-cmd --reload\n")])])]),e("p",[s._v("2.因为后面GitLab需要配合Jenkins以实现提交代码就完成自动部署，所以如果有需要，则要添加GitLab服务器的IP，使得GitLab服务器可以访问Jenkins服务器。")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --permanent --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("trusted --add-source"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.26")]),s._v(".1.15 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加IP")]),s._v("\nfirewall-cmd --reload\nfirewall-cmd --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("trusted --list-all\n")])])]),e("p",[s._v("3.因为后面Jenkins要去拉取gitlab的代码，所以需要生成ssh密钥")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("ssh-keygen -t rsa -b "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" -C "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your_email@example.com"')]),s._v("\n")])])]),e("p",[s._v("将公钥添加到gitlab：来到gitlab个人中心，点设置，左边点SSH密钥，右边填入id_rsa.pub里面的字符，然后点添加密钥即可。")]),s._v(" "),e("p",[e("strong",[s._v("Jenkins配置")])]),s._v(" "),e("ol",[e("li",[e("p",[s._v("Jenkins默认端口为8080， 有冲突的自行修改")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v("  /etc/sysconfig/jenkins\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#例 修改为")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JENKINS_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8080"')]),s._v("\n")])])])]),s._v(" "),e("li",[e("p",[s._v("配置JDK路径，JDK安装目录是自定义的，需要添加")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/init.d/jenkins\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#加上自己的jdk路径")]),s._v("\n")])])]),e("p",[s._v("我这里添加过软链接到/usr/bin/java，所以不用再添加了。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(486),alt:""}})])]),s._v(" "),e("li",[e("p",[s._v("启动")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl start jenkins\n")])])])]),s._v(" "),e("li",[e("p",[s._v("访问\n通过IP:Port即可访问Jenkin页面，通过提示找到密码登录。\n"),e("img",{attrs:{src:t(487),alt:""}}),s._v("\n插件安装选择安装推荐的插件即可。可能安装失败，重试或者继续暂时忽略失败的插件安装。\n"),e("img",{attrs:{src:t(488),alt:""}}),s._v("\n等待片刻（其实要很久），就安装完成了。")])])]),s._v(" "),e("h3",{attrs:{id:"安装插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装插件"}},[s._v("#")]),s._v(" 安装插件")]),s._v(" "),e("p",[s._v("【系统管理--\x3e插件管理】可以在线安装需要的插件，但是安装比较慢，还经常失败，推荐设置升级站点或上传插件离线安装。")]),s._v(" "),e("p",[s._v("本文章需要编译Vue项目，所以需要单独安装一个NodeJS插件。")]),s._v(" "),e("p",[e("strong",[s._v("设置升级站点")]),s._v("\n【系统管理--\x3e插件管理--\x3e高级--\x3e升级站点】")]),s._v(" "),e("p",[s._v("替换升级站点URL，这里推荐两个地址可用：")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("http://mirror.esuni.jp/jenkins/updates/update-center.json\n")])])]),e("p",[s._v("或")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json\n")])])]),e("p",[s._v("其它的Jenkins的镜像地址可以查询：http://mirrors.jenkins-ci.org/status.html")]),s._v(" "),e("p",[s._v("保存后，即可返回到【可选插件】选项卡下，进行搜索重新安装。")]),s._v(" "),e("p",[e("strong",[s._v("离线安装")])]),s._v(" "),e("p",[s._v("可以通过上面提供的国内镜像地址下载好插件，如：https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/ 然后通过【系统管理--\x3e插件管理--\x3e高级--\x3e上传插件】来离线安装")]),s._v(" "),e("h3",{attrs:{id:"安装nodejs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装nodejs"}},[s._v("#")]),s._v(" 安装NodeJS")]),s._v(" "),e("p",[s._v("本文章需要编译前端的Vue项目，上面安装好了插件，现在还需要本机安装好NodeJS。")]),s._v(" "),e("p",[s._v("（1）去nodejs官网下载最新包")]),s._v(" "),e("blockquote",[e("p",[s._v("官网下载地址:https://nodejs.org/dist/latest/")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://nodejs.org/dist/latest/node-v12.18.3-linux-x64.tar.gz\n")])])]),e("p",[s._v("（2）解压安装")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xvzf node-v12.18.3-linux-x64.tar.gz -C /opt\n")])])]),e("p",[s._v("（3）修改环境变量")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/profile\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/node-v12.18.3-linux-x64/bin:"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n")])])]),e("p",[s._v("（4）刷新环境变量，使其生效")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n")])])]),e("p",[s._v("（5） 安装cnpm与配置淘宝镜像")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g cnpm --registry"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https://registry.npm.taobao.org"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("https://registry.npm.taobao.org/"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),e("p",[s._v("（6） 查看npm,cnpm,node版本号")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("node -v\ncnpm -v\n")])])]),e("h3",{attrs:{id:"配置nodejs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置nodejs"}},[s._v("#")]),s._v(" 配置NodeJS")]),s._v(" "),e("blockquote",[e("p",[s._v("Jenkins中配置node")])]),s._v(" "),e("p",[s._v("【系统配置--\x3e全局工具配置--\x3eNodeJS】配置安装好的node路径。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(489),alt:""}})]),s._v(" "),e("h2",{attrs:{id:"jenkins任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jenkins任务"}},[s._v("#")]),s._v(" Jenkins任务")]),s._v(" "),e("h3",{attrs:{id:"构建任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建任务"}},[s._v("#")]),s._v(" 构建任务")]),s._v(" "),e("p",[s._v("现在可以新建一个【构建任务】了。点击新建任务，输入任务名称，选择构建一个自由风格的软件项目，点击确定进入下一步。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(490),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"源码管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码管理"}},[s._v("#")]),s._v(" 源码管理")]),s._v(" "),e("p",[s._v("选择【源码管理】，输入仓库地址，会提示连接不上，这时候前面生成的ssh-key就派上用场了。点击添加按钮,")]),s._v(" "),e("p",[e("img",{attrs:{src:t(491),alt:""}})]),s._v(" "),e("p",[s._v("如图所示添加凭据，将之前生成的私钥添加到Key中，点击添加后即可在上一步的Credentials后面的下拉框中选择刚刚添加的凭据。\n"),e("img",{attrs:{src:t(492),alt:""}})]),s._v(" "),e("p",[s._v("选择后就不报错了，说明可以访问到gitlab仓库了。\n"),e("img",{attrs:{src:t(493),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"构建触发器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建触发器"}},[s._v("#")]),s._v(" 构建触发器")]),s._v(" "),e("p",[s._v("选择【构建触发器】，选中【触发远程构建】，输入一个身份验证令牌，后面要用。"),e("a",{attrs:{href:"#build-triggers"}}),s._v(" "),e("img",{attrs:{src:t(494),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"构建环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建环境"}},[s._v("#")]),s._v(" 构建环境")]),s._v(" "),e("p",[s._v("选择【构建环境】，选择【Provide Node & npm bin/ folder to PATH】，然后选择我们配置好的Node环境。\n"),e("img",{attrs:{src:t(495),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"构建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[s._v("#")]),s._v(" 构建")]),s._v(" "),e("p",[s._v("选择【构建】，【增加构建步骤】选择【执行Shell】,然后填入构建时对应需要执行的shell脚本。")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#声明环境变量")]),s._v("\ncnpm cache verify "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#清除缓存")]),s._v("\ncnpm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编译")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拷贝dist下所有文件到nginx对应目录下")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -Rf /var/lib/jenkins/workspace/bde-data/dist/*  /usr/local/nginx/html/bde/ \n")])])]),e("p",[s._v("如下图：\n"),e("img",{attrs:{src:t(496),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"构建后操作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建后操作"}},[s._v("#")]),s._v(" 构建后操作")]),s._v(" "),e("p",[s._v("可以配置邮件通知等操作，这里就不配了。")]),s._v(" "),e("h2",{attrs:{id:"配置webhook"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置webhook"}},[s._v("#")]),s._v(" 配置WebHook")]),s._v(" "),e("h3",{attrs:{id:"获取账户token"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取账户token"}},[s._v("#")]),s._v(" 获取账户token")]),s._v(" "),e("p",[s._v("登录有效账户，【用户列表--\x3e点击用户ID--\x3e设置--\x3eAPI Token--\x3e添加新Token】点击生成，即可生成一个Token\n"),e("img",{attrs:{src:t(497),alt:""}})]),s._v(" "),e("h3",{attrs:{id:"获取项目token"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取项目token"}},[s._v("#")]),s._v(" 获取项目Token")]),s._v(" "),e("p",[s._v("之前"),e("a",{attrs:{href:"#build-triggers"}},[s._v("构建触发器")]),s._v("时输入的身份验证令牌就是项目Token，可以去项目任务配置那获取或重新配置。")]),s._v(" "),e("h3",{attrs:{id:"生成触发器url"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成触发器url"}},[s._v("#")]),s._v(" 生成触发器URL")]),s._v(" "),e("p",[s._v("之前"),e("a",{attrs:{href:"#build-triggers"}},[s._v("构建触发器")]),s._v("时那里有提示URL的格式。")]),s._v(" "),e("p",[s._v("JENKINS_URL/job/bde-data/build?token=TOKEN_NAME 或者 /buildWithParameters?token=TOKEN_NAME\nOptionally append &cause=Cause+Text to provide text that will be included in the recorded build cause.")]),s._v(" "),e("p",[s._v("然后在需要gitlab项目的 WebHook【settings--\x3eintegrations】中填写该 URL（Trigger选择Push events代表Push代码时触发），在 host 前面加上 "),e("code",[s._v("[账户名]:[账户Token]@")]),s._v("，完整格式为："),e("code",[s._v("https://myid:mytoken@myjenkins.com/job/myJobName/build?token=my_job_token")]),s._v("。比如我这里就是：")]),s._v(" "),e("p",[e("strong",[e("code",[s._v("http://admin:11af75c3dd68048c06aaaf77e0f9a15339@172.26.11.160:8080/job/bde-data/build?token=ycyin20210108")])])]),s._v(" "),e("h2",{attrs:{id:"部署测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署测试"}},[s._v("#")]),s._v(" 部署测试")]),s._v(" "),e("p",[s._v("此时，提交一次代码，gitlab触发Jenkins构建。")]),s._v(" "),e("p",[s._v("gitlab点击编辑对应的Webhook可以看到成功：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(498),alt:""}})]),s._v(" "),e("p",[s._v("Jenkins可以看到构建状态、控制台输出等：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(499),alt:""}})]),s._v(" "),e("p",[s._v("本文参考：")]),s._v(" "),e("ol",[e("li",[s._v("https://www.cnblogs.com/fangts/p/11095316.html")]),s._v(" "),e("li",[s._v("https://blog.csdn.net/codebingo/article/details/112126788")]),s._v(" "),e("li",[s._v("https://blog.51cto.com/13760351/2382464")]),s._v(" "),e("li",[s._v("https://zhuanlan.zhihu.com/p/201307678")]),s._v(" "),e("li",[s._v("https://blog.csdn.net/chengyinwu/article/details/103056605")]),s._v(" "),e("li",[s._v("https://www.cnblogs.com/sxdcgaq8080/p/10489326.html")]),s._v(" "),e("li",[s._v("https://www.colabug.com/2018/0801/3851860/")])])])}),[],!1,null,null,null);a.default=n.exports}}]);