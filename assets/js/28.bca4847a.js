(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{514:function(a,t,n){a.exports=n.p+"assets/img/install_successful.060f6890.png"},614:function(a,t,n){"use strict";n.r(t);var r=n(4),s=Object(r.a)({},(function(){var a=this,t=a.$createElement,r=a._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[r("h1",{attrs:{id:"离线安装grafana插件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#离线安装grafana插件"}},[a._v("#")]),a._v(" 离线安装Grafana插件")]),a._v(" "),r("h2",{attrs:{id:"方案调研"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方案调研"}},[a._v("#")]),a._v(" 方案调研")]),a._v(" "),r("blockquote",[r("p",[a._v("如果是可以访问外网的情况下直接在Grafana页面的插件市场直接安装就可以，如果没有网络的情况下，\n根据官方文档"),r("a",{attrs:{href:"https://grafana.com/docs/grafana/latest/plugins/installation/#install-plugin-on-local-grafana",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://grafana.com/docs/grafana/latest/plugins/installation/#install-plugin-on-local-grafana"),r("OutboundLink")],1),a._v(",有如下说明：\nYou can either install the plugin with a Grafana CLI command or by downloading and uncompress a .zip file into the Grafana plugins directory.\n我们可以使用Grafana CLI或者直接将解压后的安装包复制到插件目录即可。")]),a._v(" "),r("p",[a._v("这里使用第二种方式。")])]),a._v(" "),r("h2",{attrs:{id:"准备安装包"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#准备安装包"}},[a._v("#")]),a._v(" 准备安装包")]),a._v(" "),r("blockquote",[r("p",[a._v("以"),r("code",[a._v("Pie Chart")]),a._v("这个插件为例，"),r("a",{attrs:{href:"https://grafana.com/grafana/plugins/grafana-piechart-panel/?tab=installation",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://grafana.com/grafana/plugins/grafana-piechart-panel/?tab=installation"),r("OutboundLink")],1)])]),a._v(" "),r("p",[a._v("使用命令下载或者直接在上面的grafana插件市场中点击下载。")]),a._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[a._v("$ "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://storage.googleapis.com/plugins-community/grafana-piechart-panel/release/1.6.2/grafana-piechart-panel-1.6.2.zip\n$ "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("unzip")]),a._v(" grafana-piechart-panel-1.6.2.zip -d YOUR_PLUGIN_DIR/grafana-piechart-panel\n")])])]),r("h2",{attrs:{id:"安装"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),r("p",[a._v("将"),r("strong",[a._v("解压后")]),a._v("的安装包复制到grafana插件目录中，然后重启grafana即可完成。")]),a._v(" "),r("p",[a._v("由于测试环境使用的是Helm在K8s安装的Grafana，所以直接将安装包使用"),r("code",[a._v("kubectl cp")]),a._v("复制到挂载的插件卷中即可")]),a._v(" "),r("p",[r("strong",[a._v("确认挂载的Grafana插件卷目录")])]),a._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[a._v("$ kubectl get pod grafana-557846c649-46xcc -n gtp-metric -o yaml "),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),a._v("\n    - mountPath: /etc/grafana/grafana.ini\n    - mountPath: /var/lib/grafana\n    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount\n    - mountPath: /var/lib/grafana\n    - mountPath: /var/run/secrets/kubernetes.io/serviceaccount\n$ kubectl "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -it -n gtp-metric grafana-557846c649-46xcc -- "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/grafana/grafana.ini\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("paths"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\ndata "),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/lib/grafana/data\nlogs "),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/log/grafana\nplugins "),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /var/lib/grafana/plugins\nprovisioning "),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" /etc/grafana/provisioning\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(".\n")])])]),r("p",[a._v("可以确认插件挂载目录就是"),r("code",[a._v("/var/lib/grafana/plugins")])]),a._v(" "),r("p",[r("strong",[a._v("复制插件到Grafana插件卷目录")])]),a._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[a._v("$ kubectl "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /data/grafana-piechart-panel -n gtp-metric grafana-557846c649-46xcc:/var/lib/grafana/plugins/\n\n$ kubectl "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -it -n gtp-metric grafana-557846c649-46xcc -- "),r("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" /var/lib/grafana/plugins\ngrafana-piechart-panel\n\n")])])]),r("p",[r("strong",[a._v("重启pod")])]),a._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[a._v("$ kubectl get pod grafana-557846c649-46xcc -n gtp-metric -o yaml "),r("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" kubectl replace --force -f -\n")])])]),r("p",[a._v("至此，离线安装Grafana插件完成，访问Grafana页面的插件页面即可看到刚刚安装的插件。")]),a._v(" "),r("p",[r("img",{attrs:{src:n(514),alt:""}})]),a._v(" "),r("h2",{attrs:{id:"小结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[a._v("#")]),a._v(" 小结")]),a._v(" "),r("p",[a._v("离线安装Grafana插件，只需要将插件下载下来解压放到Grafana插件目录中，然后重启Grafana即可。")])])}),[],!1,null,null,null);t.default=s.exports}}]);